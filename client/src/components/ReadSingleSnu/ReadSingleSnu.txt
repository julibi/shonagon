import React, { Component } from 'react';
import style from './ReadSingleSnu.css'

import Typist from 'react-typist';
import ReactCSSTransitionGroup from 'react-addons-css-transition-group';

export default class ReadSingleSnu extends Component {
  constructor(props) {
    super(props);
    this.state = { showTitles: false };
  }
  renderRandomSnu() {
    const { randomSnu } = this.props;
    const { showTitles } = this.state;
    // preselect a keyword
    // dispatch the action that searches for other keywords (action I)

    if(randomSnu) {
      return (
        <div>
          <h3><Typist cursor={ { show: false } }>{ randomSnu.title }</Typist></h3>
          <div className={ style.image }><img src={ require('./test.jpg') }/></div>
            <ReactCSSTransitionGroup
              transitionName="snu"
              transitionAppear={ true }
              transitionAppearTimeout={ 1000 }
              transitionEnter={ false }
              transitionLeave={ false }
            >
              <p className={ style.blaa }>{ randomSnu.text }</p>
            </ReactCSSTransitionGroup>
          { !showTitles ? (
            <div>
              <button>Some other</button>
              <button onClick={ () => this.handleDoneReading(randomSnu) }>Done reading, next</button>
            </div>
          ) : (
            <ReactCSSTransitionGroup
              transitionName="keywords"
              transitionAppear={ true }
              transitionAppearTimeout={ 1000 }
              transitionEnter={ false }
              transitionLeave={ false }
            >
            <div>
              <ul>{ this.props.keywordMatchingSnus.map((keywordMatchingSnu, idx) => 
                <li key={ idx }>
                  <button onClick={ () => this.fetchNextSnu(keywordMatchingSnu._id) }>
                    { keywordMatchingSnu.title }
                  </button>
                </li>) }
              </ul> 
            </div>
            </ReactCSSTransitionGroup>
          )
          }
        </div>
      );
    }
    return <div>Loading ...</div>
  }

  handleDoneReading(snu) {
    const { setToRead, getSnusMatchingKeyword } = this.props;
    const id = snu._id; 
    if (snu.keywords.length > 0 && setToRead) {
      // setToRead(id, snu);

      this.setState({ showTitles: true });

      const randomIndex = Math.floor(Math.random() * snu.keywords.length);
      const randomKeyword = snu.keywords[randomIndex];

      getSnusMatchingKeyword(randomKeyword);
    } else {
        // IF IT DOESN'T dispatch the randomnext action (action II)
        console.log('Here will soon be the select random next snu action :)');
    } 
  }

  fetchNextSnu(id) {
          // IF IT HAS
          const { fetchSnu } = this.props;
          fetchSnu(id);
          this.setState({ showTitles: false });
            // axios.get(ROOT/snu/keyword) <-- create new route for that! (ROUTE I)
              // do all the database BRAINFUCK
              // if there is a fitting snu, thats great
              // if there isnt  dispatch (action II)
  }      

  fetchRandomSnu() {

  }

  render() {
    console.log('ReadSingleSnu, this.props: ', this.props);
    return (
      <div className={style.App}>
        <div>{ this.renderRandomSnu() }</div>
      </div>
    );
  }
}

{/* <ul>{ randomFirstSnu.keywords.map((keyword, idx) => 
            <li key={ idx }>
              <button onClick={ () => this.handleNext(randomFirstSnu) }>
                { keyword }
              </button>
            </li>) }
          </ul> */}
